//Лабораторная работа № 6
//Программа под названием opros (опрос) — это мини-тест, который просит пользователя ввести число.
//Она анализирует это число по определённым правилам, и сообщает, подходит ли оно (выполняет ли заданные условия).
//У пользователя есть три попытки — после трёх ошибок программа завершает работу.

Program opros;
uses CRT;

var
  k : integer;     { счетчик попыток }
  z : string;      { ввод пользователя (строка) }
  f : boolean;     { флаг — введенное значение подходит? }

{---------------- Процедура анализа введенной строки ----------------}
Procedure analiz(a: string; var f: boolean);
var
  b, q, con, os: integer;
  t: string;
Begin
  q := Length(a);    { длина введенной строки }
  f := false;        { по умолчанию — не подходит }

  { Если строка короче 5 символов: просто проверяем, является ли это числом и четным }
  if q < 5 then
  begin
    val(a, con, os);                   { пробуем преобразовать в число }
    if (os = 0) and (con mod 2 = 0) then
      f := true;
  end
  else
  { Если строка ровно 5 символов: более детальная проверка (чтобы не превышать 32768) }
  if q = 5 then
  begin
    { Изначально считаем false; выставим true только при выполнении всех условий }
    f := false;
    t := Copy(a, 1, 4);               { первые 4 символа }
    val(t, con, os);
    if os = 0 then                     { первые 4 — число? }
    begin
      if con <= 3276 then             { чтобы при добавлении последней цифры не превысить 32768 }
      begin
        t := Copy(a, 5, 1);           { последняя (пятая) цифра }
        val(t, con, os);
        if os = 0 then                { последняя — цифра? }
        begin
          if con <= 8 then            { последняя цифра ≤ 8 (вместе: ≤ 32768) }
          begin
            b := con mod 2;          { чётность последней цифры }
            if b = 0 then f := true; { если чётная — условие выполнено }
          end
          else f := false;
        end
        else f := false;
      end
      else f := false;
    end
    else f := false;
  end
  else
    { Во всех прочих случаях (длина >5) — не подходит }
    f := false;
End;

{---------------- Процедура подсказки ----------------}
Procedure Help;
Begin
  TextColor(2);      { зелёный цвет }
  k := k + 1;        { использование подсказки уменьшает число оставшихся попыток }
  writeln('Подсказка: нужно ввести число, которое делится на 2');
End;

{---------------- Основной блок программы ----------------}
Begin
  ClrScr;
  TextColor(15);
  writeln('Эта программа проверяет ваши знания чисел.');
  k := 1;            { начинаем с первой попытки }

  while k < 4 do     { максимум 3 попытки }
  begin
    TextColor(15);
    writeln('Введите любое целое число в диапазоне от -32767 до 32768');
    writeln;
    writeln('Если не знаете, наберите "?" для подсказки');
    writeln;
    readln(z);

    if z = '?' then
      Help
    else
    begin
      analiz(z, f);          { анализ введенной строки }
      if f = true then
      begin
        TextColor(9);        { синий — успех }
        writeln('Вы абсолютно правы! Поздравляю!');
        writeln;
        k := 5;             { прерываем цикл (успех) }
      end
      else
      begin
        TextColor(12);       { красный — ошибка }
        writeln('Неверный ответ.');
        k := k + 1;
        if k = 4 then
          writeln('Вы исчерпали все попытки.')
        else
          writeln('Попробуйте ещё раз.');
      end;
    end;
  end;

  readln;  { пауза перед выходом }
End.
